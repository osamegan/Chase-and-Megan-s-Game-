<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Chase and Megan's Game</title>
        <script>
            function allowDrop(ev) {
              ev.preventDefault();
            }
            
            function drag(ev) {
              ev.dataTransfer.setData("text", ev.target.id);
            }
            
            function drop(ev) {
              ev.preventDefault();
              var data = ev.dataTransfer.getData("text");
              ev.target.appendChild(document.getElementById(data));
            }
            </script>

</head>
<body onload = "setBoard()">

    <style>
    
    .start {
        background-color: green;
        margin: 0% 48%;
        margin-top: 50px;
        padding: 5px;
        color: white;
        width:fit-content;
    }

    .chessboard {
        width: 600px;
        height: 600px;
        margin: auto;
        border-collapse: collapse;
        border-spacing: 0px;
    }

    .whiteTile {
        border: 1px solid black;
        width: 30px;
        height: 30px;
        background-color: white;
        margin: 0px;
        border-collapse: collapse;
    }

    .blackTile {
        border: 1px solid black;
        width: 30px;
        height: 30px;
        background-color: black;
        margin: 0px;
        border-collapse: collapse;
    }

    .packed {
        padding: 0;
        margin: 0;
        border-collapse: collapse;
        width: 30px;
        height: 30px;
        display: inline-block;
    }

    </style>

    <h1 style="text-align: center;">Chess.io</h1>

    <img id = "redRook" src="Red-Ghost-Left.png" alt="" height = 0px width = 0px>
    <img id = "blueRook" src="Blue-Ghost-Left.png" alt="" height = 0px width = 0px>
    <img id = "pinkRook" src="Pink-Ghost-Left.png" alt="" height = 0px width = 0px>
    <img id = "orangeRook" src="Orange-Ghost-Left.png" alt="" height = 0px width = 0px>
    <img id = "redKnight" src="Red-Pacman.png" alt="" height = 0px width = 0px>
    <img id = "blueKnight" src="Blue-Pacman.png" alt="" height = 0px width = 0px>
    <img id = "pinkKnight" src="Pink-Pacman.png" alt="" height = 0px width = 0px>
    <img id = "orangeKnight" src="Orange-Pacman.png" alt="" height = 0px width = 0px>
    <img id = "redBishop" src="Scared-Ghost-Red.png" alt="" height = 0px width = 0px>
    <img id = "blueBishop" src="Scared-Ghost-Blue.png" alt="" height = 0px width = 0px>
    <img id = "pinkBishop" src="Scared-Ghost-Pink.png" alt="" height = 0px width = 0px>
    <img id = "orangeBishop" src="Scared-Ghost-Orange.png" alt="" height = 0px width = 0px>
    <img id = "redKing" src="Red-King.png" alt="" height = 0px width = 0px>
    <img id = "blueKing" src="Blue-King.png" alt="" height = 0px width = 0px>
    <img id = "pinkKing" src="Pink-King.png" alt="" height = 0px width = 0px>
    <img id = "orangeKing" src="Orange-King.png" alt="" height = 0px width = 0px>

    <table id = "chessboard"></table>
    <script>
        
        let board = document.getElementById("chessboard");
        board.setAttribute("class", "chessboard");
        let letters = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T'];
        let chessPieces = [];
        let selected = {};
        let turn = -28;
        const moves = {
            rook: {
                vertical: true,
                horizontal: true,
                diagonal: false,
                knight: false,
                range: Infinity,                
                leavable: true,
            },

            bishop: {
                vertical: false,
                horizontal: false,
                diagonal: true,
                knight: false,
                range: Infinity,
                leavable: true,
            },

            knight: {
                vertical: false,
                horizontal: false,
                diagonal: false,
                knight: true,
                range: undefined,
                leavable: true,
            },

            king: {
                vertical: true,
                horizontal: true,
                diagonal: true,
                knight: false,
                range: 1,
                leavable: false,
            }
        };

        function setBoard() {
            let start = document.createElement("BUTTON");
            start.setAttribute("class", "start");
            start.id = "start";
            start.innerHTML = "Start Game";
            start.setAttribute("onclick", "start()");
            document.body.appendChild(start);
            createBoard();
            chooseColor();
        }

        function createBoard () {
            let start = document.getElementById("start");
            let letterNum = 0;
            let number = 1;
            for (let columnLength = 0; columnLength < 20; columnLength ++) {
                let column = document.createElement("TR");
                column.setAttribute("class", "packed");
                for (let rowLength = 0; rowLength < 20; rowLength ++) {
                    let row = document.createElement("TD");
                    row.setAttribute("class", "packed");
                    let tile = document.createElement("CANVAS");
                    tile.id = `${letters[letterNum]}${number}`
                    tile.setAttribute("class", "packed");
                    tile.addEventListener("click", (e) => {
                        if (selected.piece && !tile.piece) {
                            moveTo(selected.piece, tile.id);
                            selected.tile.setAttribute("style", "border: 1px solid black");
                            let ctx = selected.tile.getContext("2d");
                            ctx.clearRect(0, 0, selected.tile.width, selected.tile.height);
                            delete selected.piece;
                            delete selected.tile;
                        } else {
                            tile.setAttribute("style", "border: 1px solid blue");
                            selected.tile ? selected.tile.setAttribute("style", "border: 1px solid black") : selected.tile = tile;
                            selected.tile = tile;
                            tile.piece ? selected.piece = tile.piece : tile.piece = null;
                        }
                    });
                    if (columnLength  % 2 === 0) {
                        rowLength % 2 === 0 ? tile.setAttribute("class", "whiteTile") : tile.setAttribute("class", "blackTile");
                    } else {
                        rowLength % 2 != 0 ? tile.setAttribute("class", "whiteTile") : tile.setAttribute("class", "blackTile");
                    }
                    row.appendChild(tile);
                    column.appendChild(row);
                    number ++;
                }
                board.appendChild(column);
                number = 1;
                letterNum ++;
            }
            document.body.insertBefore(board, start);
        }

        function chooseColor() {
            let color1 = "red";
            let color2 = "blue";
            let color3 = "pink";
            let color4 = "orange";
            setPieces([color1, color2, color3, color4]);
        }

        function setPieces(colors) {
            for (let color of colors) {
                createPiece('Rook', color, 1);
                createPiece('Rook', color, 2);
                createPiece('Bishop', color, 1);
                createPiece('Bishop', color, 2)
                createPiece('Knight', color, 1);
                createPiece('Knight', color, 2);
                createPiece('King', color, 1);
            }
            let positions = ["C1", "B3", "C2", "A3", "B2", "C3", "A1", "B18", "C20", "A18", "C19", "C18", "B19", "A20", "R1", "S3", "R2", "T3", "S2", "R3", "T1", "S18", "R20", "T18", "R19", "R18", "S19", "T20"];
            for (let pieces in chessPieces) {
                let position = positions[pieces];
                if (position) {
                    let tile = document.getElementById(position)
                    let ctx = tile.getContext("2d");
                    ctx.drawImage(chessPieces[pieces].image, 7.5, 3.75, 275, 134.5);
                    tile.piece = chessPieces[pieces];
                    chessPieces[pieces].currentPos = position;
                }
            }
        }

        function createPiece(type, color, number) {
            let piece = {};
            piece.image = new Image();
            piece.image.src = document.getElementById(`${color}${type}`).src;
            piece.id = `${color}${type}${number}`;
            piece.movability = moves[type.toLowerCase()];
            chessPieces.push(piece);
        }

        function moveTo(piece, square) {
            let tile = document.getElementById(square);
            let ctx = tile.getContext("2d");
            if (checkLegality(piece, square) === 'legal') {
                ctx.drawImage(piece.image, 7.5, 3.75, 275, 134.5);
                tile.piece = piece;
                piece.currentPos = square;
            }
            turn ++;
        }

// The letters and numbers of the id system need to be switched!!!

        function checkLegality(piece, square) {
            let startId = piece.currentPos;
            let endId = square;
            let moveType = null;
            let slope = (letters.indexOf(startId[0]) + 1 - letters.indexOf(endId[0]) + 1) / (Number(startId[1]) - Number(endId[1]));
            console.log(startId);
            console.log(letters.indexOf(startId[0]));
            console.log(slope);
            console.log(letters.indexOf(startId[0]) + 1 - letters.indexOf(endId[0]) + 1);
            console.log(Number(startId[1]) - Number(endId[1]));
            if (startId[0] === endId[0]) {
                moveType = 'horizontal';
            } else if (startId[1] === endId[1]){
                moveType = 'vertical';
            } else if (Math.abs(slope) = 1) {
                moveType = 'diagonal';
            } else if (Math.abs(slope) === 2 || Math.abs(slope) === 0.5) {
                moveType = 'knight';
            } else {
                moveType = 'invalid';
            }
            piece.movability[moveType] ? jurisdiction = 'legal' : jurisdiction = 'illegal';
            return jurisdiction;
        }

        function start() {
            
        }
       
        function allowDrop(ev) {
            ev.preventDefault();
        }

        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
        }

        function drop(ev) {
            ev.preventDefault();
            var data = ev.dataTransfer.getData("text");
            ev.target.appendChild(document.getElementById(data));
        }
    </script>
</body>
</html> 